import asyncio
import sqlite3
import os
from datetime import datetime, timedelta
import pytz
from telethon import TelegramClient, events
from telethon.sessions import StringSession
import logging
import re
import aiohttp
import feedparser

# ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =====
API_ID = 24826804
API_HASH = '048e59c243cce6ff788a7da214bf8119'
SESSION_STRING = "1ApWapzMBuy-exPfF7z634N4Gos8qEwxZ92Nj1r4PWBEd55yqbaP_jcaTT6RiRwd5N4k2snlw_NaVLZ_2C4AvxvB_UG_exIrWgIOj6wsZrHlvBKt92xsGsEbZeo3l95d_6Vr5KKgWaxw531DwOrtWH-lerhkJ7XlDWtt_c225I7W0lIAk8P_k6gzm5oGvRFXqe0ivHxU7q4sJz6V61Ca0jyA_Sv-74OxB9l07HmIbOAC66oCtekxj4G5MTKKudofzmu2IqjqTgfFHwnKzE6hA3qik1SqSWdtWvmXHGb_44qPSk2dWGdW7vsN8inFuByDQLCF1_VLdGe0aFohbN0TXKKi7k0C8g2I="
BOT_TOKEN = '7597923417:AAEyZvTyyrPFQDz1o1qURDeCEoBFc0fMWaY'

# Telegram –∫–∞–Ω–∞–ª—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
CHANNELS = [
    'gubernator_46', 'kursk_info46', 'Alekhin_Telega', 'rian_ru',
    'kursk_ak46', 'zhest_kursk_146', 'novosti_efir', 'kursk_tipich',
    'seymkursk', 'kursk_smi', 'kursk_russia', 'belgorod01', 'kurskadm',
    'incident46', 'kurskbomond', 'prigranichie_radar1', 'grohot_pgr',
    'kursk_nasv', 'mchs_46', 'patriot046', 'kursk_now', 'Hinshtein',
    'incidentkursk', 'zhest_belgorod', 'RVvoenkor', 'pb_032',
    'tipicl32', 'bryansk_smi', 'Ria_novosti_rossiya','criminalru','bra_32','br_gorod','br_zhest', 
    'pravdas', 'wargonzo', 'ploschadmedia', 'belgorod_smi','ssigny','rucriminalinfo',
    'kurskiy_harakter','dva_majors','ENews112', 'rt_russian', 'bbbreaking', 'readovkanews'
]

# –í–µ–±-—Å–∞–π—Ç—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
WEBSITES = [
    {
        'name': '–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏',
        'url': 'https://ria.ru/export/rss2/archive/index.xml',
        'type': 'rss'
    },
    {
        'name': '–¢–ê–°–°',
        'url': 'https://tass.ru/rss/v2.xml', 
        'type': 'rss'
    },
    {
        'name': '–ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å',
        'url': 'https://www.interfax.ru/rss.asp',
        'type': 'rss'
    },
    {
        'name': '–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –ö–æ–º—Å–æ–º–æ–ª–µ—Ü',
        'url': 'https://www.mk.ru/rss/index.xml',
        'type': 'rss'
    },
    {
        'name': 'RT –Ω–∞ —Ä—É—Å—Å–∫–æ–º',
        'url': 'https://russian.rt.com/rss/',
        'type': 'rss'
    },
    {
        'name': '–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –§–∞–∫—Ç—ã', 
        'url': 'https://aif.ru/rss/news.php',
        'type': 'rss'
    }
]

# ===== –í–ï–ß–ù–´–ï –ü–û–î–ü–ò–°–ß–ò–ö–ò =====
# –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò ID –ù–ê –†–ï–ê–õ–¨–ù–´–ï ID –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –¢–ï–õ–ï–ì–†–ê–ú!
PERMANENT_SUBSCRIBERS = [
    1175795428,   # –ü–†–ò–ú–ï–†: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID
    8019965642,   # –ü–†–ò–ú–ï–†: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID
]

# ===== –°–£–ü–ï–†-–§–ò–õ–¨–¢–†: –¢–û–õ–¨–ö–û –í–û–ô–ù–ê, –ü–û–õ–ò–¢–ò–ö–ê, –°–ï–†–¨–ï–ó–ù–´–ï –°–û–ë–´–¢–ò–Ø =====
WAR_KEYWORDS = [
    # –í–æ–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—Ä—É–∂–∏–µ
    '–æ–±—Å—Ç—Ä–µ–ª', '–∞—Ç–∞–∫–∞', '–ø—Ä–∏–ª–µ—Ç', '–¥–∏–≤–µ—Ä—Å–∞–Ω—Ç', '–î–†–ì', '–±–æ–µ–ø—Ä–∏–ø–∞—Å', '–≤–∑—Ä—ã–≤—á–∞—Ç–∫–∞', '—Ä–∞–∫–µ—Ç–∞', '–ò—Å–∫–∞–Ω–¥–µ—Ä',
    '–ø–ª–µ–Ω–Ω—ã–π', '–ø–ª–µ–Ω', '–†–≠–ë', '—Ä–∞–¥–∏–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –±–æ—Ä—å–±–∞', '–ø—Ä–∏–≥—Ä–∞–Ω–∏—á—å–µ', '–Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ', '–∫–æ–Ω—Ç—Ä–Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ',
    '–æ–∫—Ä—É–∂–µ–Ω–∏–µ', '—à—Ç—É—Ä–º', '–∞—Ä—Ç–æ–±—Å—Ç—Ä–µ–ª', '–º–∏–Ω–æ–º–µ—Ç', '–∞—Ä—Ç–∏–ª–ª–µ—Ä–∏—è', '—Ç–∞–Ω–∫', '–ë–ú–ü', '–ë–¢–†', '–°–ê–£',
    '–±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫', '–¥—Ä–æ–Ω', 'FPV-–¥—Ä–æ–Ω', '–ì–µ—Ä–∞–Ω—å', '–®–∞—Ö–µ–¥', '–õ–∞–Ω—Ü–µ—Ç', '–ö—É–±', '–ë—É–∫', '–ü–∞–Ω—Ü–∏—Ä—å', '–¢–æ—Ä',
    '–°-300', '–°-400', '–ò—Å–∫–∞–Ω–¥–µ—Ä', '–ö–∞–ª–∏–±—Ä', '–ö–∏–Ω–∂–∞–ª', '–¶–∏—Ä–∫–æ–Ω', '–•-101', '–•-32', '–•-59',
    '—Ñ–æ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è', '—É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ', '—Ç—Ä–∞–Ω—à–µ—è', '–±—É–Ω–∫–µ—Ä', '–¥–æ—Ç', '–¥–∑–æ—Ç', '–∑–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ', '–º–∏–Ω–∞', '—Ñ—É–≥–∞—Å',
    
    # –í–æ–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
    '–í–°–£', '–í–° –†–§', '–ß–í–ö', '–í–∞–≥–Ω–µ—Ä', '–ê—Ö–º–∞—Ç', '–ö–∞–¥—ã—Ä–æ–≤', '–°–°–û', '—Ä–∞–∑–≤–µ–¥–∫–∞', '–¥–∏–≤–µ—Ä—Å–∏—è', '—Å–ø–µ—Ü–æ–ø–µ—Ä–∞—Ü–∏—è',
    '–Ω–∞–µ–º–Ω–∏–∫', '–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–∏–∫', '–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è', '–º–æ–±–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π', '–ø—Ä–∏–∑—ã–≤', '–≤–æ–µ–Ω–∫–æ–º–∞—Ç',
    
    # –ì–µ–æ–ø–æ–ª–∏—Ç–∏–∫–∞ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
    '–ù–ê–¢–û', '–∞–ª—å—è–Ω—Å', '–°–®–ê', '–ü–µ–Ω—Ç–∞–≥–æ–Ω', '–í–∞—à–∏–Ω–≥—Ç–æ–Ω', '–ë–∞–π–¥–µ–Ω', '–ï–°', '–ï–≤—Ä–æ—Å–æ—é–∑', '—Å–∞–Ω–∫—Ü–∏—è', '—ç–º–±–∞—Ä–≥–æ',
    '–≤–æ–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å', '–≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ', '–æ—Ä—É–∂–∏–µ', 'F-16', '–ê–±—Ä–∞–º—Å', '–õ–µ–æ–ø–∞—Ä–¥', '–ß–µ–ª–ª–µ–Ω–¥–∂–µ—Ä', '–ü–ê–¢–†–ò–û–¢',
    '–•–∞–π–º–∞—Ä—Å', '–∞—Ä—Ç–∞', '–°–ê–£', '–ë—Ä–∞–¥–ª–∏', '–°—Ç—Ä–∞–π–∫–µ—Ä', '–ñ–µ–ª–µ–∑–Ω—ã–π –∫—É–ø–æ–ª', '–ü–í–û', '–ü–†–û',
    
    # –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∏ —Ñ—Ä–æ–Ω—Ç—ã
    '–î–æ–Ω–±–∞—Å—Å', '–î–ù–†', '–õ–ù–†', '–ö—Ä—ã–º', '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', '–•–µ—Ä—Å–æ–Ω', '–ó–∞–ø–æ—Ä–æ–∂—å–µ', '–ú–∞—Ä–∏—É–ø–æ–ª—å', '–ë–∞—Ö–º—É—Ç',
    '–ê–≤–¥–µ–µ–≤–∫–∞', '–£–≥–ª–µ–¥–∞—Ä', '–í–æ–ª–Ω–æ–≤–∞—Ö–∞', '–õ–∏–º–∞–Ω', '–ò–∑—é–º', '–ö—É–ø—è–Ω—Å–∫', '–•–∞—Ä—å–∫–æ–≤', '–°—É–º–º—ã', '–ß–µ—Ä–Ω–∏–≥–æ–≤',
    '–õ—É–≥–∞–Ω—Å–∫', '–î–æ–Ω–µ—Ü–∫', '–ú–µ–ª–∏—Ç–æ–ø–æ–ª—å', '–ë–µ—Ä–¥—è–Ω—Å–∫', '–≠–Ω–µ—Ä–≥–æ–¥–∞—Ä', '–ù–∏–∫–æ–ª–∞–µ–≤', '–û–¥–µ—Å—Å–∞',
    
    # –†–æ—Å—Å–∏–π—Å–∫–∏–µ —Ä–µ–≥–∏–æ–Ω—ã (–ø—Ä–∏–≥—Ä–∞–Ω–∏—á–Ω—ã–µ)
    '–ö—É—Ä—Å–∫', '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ë–µ–ª–≥–æ—Ä–æ–¥', '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ë—Ä—è–Ω—Å–∫', '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
    '–í–æ—Ä–æ–Ω–µ–∂', '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–†–æ—Å—Ç–æ–≤', '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä', '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π',
    '–ö—Ä—ã–º', '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', '–ø–æ–Ω—ã—Ä–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '—Ä—ã–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '—à–µ–±–µ–∫–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–≤–∞–ª—É–π—Å–∫–∏–π —Ä–∞–π–æ–Ω',
    
    # –ü–æ–ª–∏—Ç–∏–∫–∞ –∏ –≤–ª–∞—Å—Ç—å (—Ç–æ–ª—å–∫–æ —Å–µ—Ä—å–µ–∑–Ω–æ–µ)
    '–ü—É—Ç–∏–Ω', '–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç', '–≥—É–±–µ—Ä–Ω–∞—Ç–æ—Ä', '–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ', '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è', '–ì–æ—Å–¥—É–º–∞', '–°–æ–≤–µ—Ç –§–µ–¥–µ—Ä–∞—Ü–∏–∏',
    '–∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç', '–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ', '–≤—ã–±–æ—Ä—ã', '—Å–∞–Ω–∫—Ü–∏–∏', '–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', '–¥–∏–ø–ª–æ–º–∞—Ç–∏—è', 
    '–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Å–∞–º–º–∏—Ç', '–≤—Å—Ç—Ä–µ—á–∞', '–ø–∞—Ä—Ç–∏—è', '–ï–¥–∏–Ω–∞—è –†–æ—Å—Å–∏—è', '–æ–ø–ø–æ–∑–∏—Ü–∏—è', '–∏–Ω–æ–∞–≥–µ–Ω—Ç',
    '–ú–µ–¥–≤–µ–¥–µ–≤', '–ü–µ—Å–∫–æ–≤', '–õ–∞–≤—Ä–æ–≤', '–®–æ–π–≥—É', '–ì–µ—Ä–∞—Å–∏–º–æ–≤', '–°—É—Ä–∫–æ–≤', '–ü–∞—Ç—Ä—É—à–µ–≤', '–ë–æ—Ä—Ç–Ω–∏–∫–æ–≤',
    
    # –≠–∫–æ–Ω–æ–º–∏–∫–∞ (—Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –≤–æ–π–Ω–æ–π/–ø–æ–ª–∏—Ç–∏–∫–æ–π)
    '–±—é–¥–∂–µ—Ç', '—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ', '–≥–æ—Å–∫–æ–Ω—Ç—Ä–∞–∫—Ç', '—Ç–µ–Ω–¥–µ—Ä', '–∞—É–∫—Ü–∏–æ–Ω', '–æ–±–æ—Ä–æ–Ω–Ω—ã–π –∑–∞–∫–∞–∑',
    '–≤–æ–µ–Ω–Ω–æ-–ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å', '–£—Ä–∞–ª–≤–∞–≥–æ–Ω–∑–∞–≤–æ–¥', '–†–æ—Å—Ç–µ—Ö', '–†–æ—Å–æ–±–æ—Ä–æ–Ω—ç–∫—Å–ø–æ—Ä—Ç', '–ê–ª–º–∞–∑-–ê–Ω—Ç–µ–π',
    '–¢–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∫–µ—Ç–Ω–æ–µ –≤–æ–æ—Ä—É–∂–µ–Ω–∏–µ', '–ö–æ–Ω—Ü–µ—Ä–Ω –ö–∞–ª–∞—à–Ω–∏–∫–æ–≤', '–í—ã–º–ø–µ–ª', '–ú–∏–ì', '–°—É—Ö–æ–π', '–¢—É–ø–æ–ª–µ–≤',
    '–∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ', '—Å—É–±—Å–∏–¥–∏—è', '–¥–æ—Ç–∞—Ü–∏—è',
    
    # –ü—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è (—Ç–æ–ª—å–∫–æ —Å–µ—Ä—å–µ–∑–Ω—ã–µ)
    '–∞–≤–∞—Ä–∏—è', '–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞', '–æ–±—Ä—É—à–µ–Ω–∏–µ', '—Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ', '–≤–∑—Ä—ã–≤', '–¥–µ—Ç–æ–Ω–∞—Ü–∏—è', '–≥–∏–±–µ–ª—å', '–ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–π',
    '—É–≥–æ–ª–æ–≤–Ω–æ–µ –¥–µ–ª–æ', '–∑–∞–¥–µ—Ä–∂–∞–Ω–∏–µ', '–∞—Ä–µ—Å—Ç', '—Å—É–¥', '–ø—Ä–∏–≥–æ–≤–æ—Ä', '–∫–æ–ª–æ–Ω–∏—è', '–°–ò–ó–û', '—Å–ª–µ–¥—Å—Ç–≤–∏–µ',
    
    # –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è)
    '–ê–≠–°', '–∞—Ç–æ–º–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è', '–ö—É—Ä—Å–∫–∞—è –ê–≠–°-2', '–ù–æ–≤–æ–≤–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –ê–≠–°', '—ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è',
    '–≥–∞–∑', '–Ω–µ—Ñ—Ç—å', '–Ω–µ—Ñ—Ç–µ–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–¥–æ—Ä–æ–≥–∏', '–º–æ—Å—Ç', '—Ç–æ–Ω–Ω–µ–ª—å', '–ø–æ—Ä—Ç', '–∞—ç—Ä–æ–ø–æ—Ä—Ç',
    
    # –û–±—â–µ—Å—Ç–≤–æ (—Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–æ–π–Ω—ã)
    '—ç–≤–∞–∫—É–∞—Ü–∏—è', '–±–µ–∂–µ–Ω–µ—Ü', '–ø–µ—Ä–µ—Å–µ–ª–µ–Ω–µ—Ü', '–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –ø–æ–º–æ—â—å', '–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è', '–≤–æ–µ–Ω–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ'
]

# ===== –°–¢–û–ü-–°–õ–û–í–ê: –í–°–ï –ù–ï–°–ï–†–¨–ï–ó–ù–´–ï –¢–ï–ú–´ =====
STOP_WORDS = [
    # –°–ø–æ—Ä—Ç –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è
    '—Ñ—É—Ç–±–æ–ª', '—Ö–æ–∫–∫–µ–π', '—Ç–µ–Ω–Ω–∏—Å', '–±–∞—Å–∫–µ—Ç–±–æ–ª', '–≤–æ–ª–µ–π–±–æ–ª', 'UFC', '–±–æ–∫—Å', '—á–µ–º–ø–∏–æ–Ω–∞—Ç', '–º–∞—Ç—á', '–≥–æ–ª',
    '—Å–ø–æ—Ä—Ç', '–æ–ª–∏–º–ø–∏–∞–¥–∞', '—Å–ø–æ—Ä—Ç—Å–º–µ–Ω', '—Ç—Ä–µ–Ω–µ—Ä', '—Å–±–æ—Ä–Ω–∞—è', '–ª–∏–≥–∞', '–Ω—Ö–ª', '–Ω–±–∞', '–∫–ª—É–±', '–∏–≥—Ä–æ–∫',
    '–∫–∏–Ω–æ', '—Å–µ—Ä–∏–∞–ª', '–∞–∫—Ç–µ—Ä', '–∞–∫—Ç—Ä–∏—Å–∞', '—Ä–µ–∂–∏—Å—Å–µ—Ä', '–ø—Ä–µ–º–∏—è', '–æ—Å–∫–∞—Ä', '–º—É–∑—ã–∫–∞', '–ø–µ—Å–Ω—è', '–∞–ª—å–±–æ–º',
    '–∫–æ–Ω—Ü–µ—Ä—Ç', '—Ñ–µ—Å—Ç–∏–≤–∞–ª—å', '–∞—Ä—Ç–∏—Å—Ç', '–≥—Ä—É–ø–ø–∞', '–∫–ª–∏–ø', '—á–∞—Ä—Ç', '–Ω–æ–º–∏–Ω–∞—Ü–∏—è', '–∫–∏–Ω–æ—Ñ–µ—Å—Ç–∏–≤–∞–ª—å',
    
    # –ù–∞—É–∫–∞ –∏ –∫–æ—Å–º–æ—Å (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≤–æ–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏)
    '–∫–æ—Å–º–æ—Å', '–∞—Å—Ç—Ä–æ–Ω–æ–º', '–ø–ª–∞–Ω–µ—Ç–∞', '–º–∞—Ä—Å', '–ª—É–Ω–∞', '—Å–ø—É—Ç–Ω–∏–∫', '—á–µ—Ä–Ω–∞—è –¥—ã—Ä–∞', '–≤—Å–ø—ã—à–∫–∞', '—Å–æ–ª–Ω—Ü',
    '–≥–∞–ª–∞–∫—Ç–∏–∫', '–∑–≤–µ–∑–¥–∞', '—Ç–µ–ª–µ—Å–∫–æ–ø', '–Ω–∞—É—á–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ', '–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ', '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è',
    '—É—á–µ–Ω—ã–π', '—Ñ–∏–∑–∏–∫', '—Ö–∏–º–∏–∫', '–±–∏–æ–ª–æ–≥', '–∞—Ä—Ö–µ–æ–ª–æ–≥', '–ø–∞–ª–µ–æ–Ω—Ç–æ–ª–æ–≥', '–¥–∏–Ω–æ–∑–∞–≤—Ä', '–∏—Å–∫–æ–ø–∞–µ–º–æ–µ',
    
    # –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–±—ã—Ç–æ–≤—ã–µ)
    '—Å–º–∞—Ä—Ç—Ñ–æ–Ω', 'iphone', 'android', '–≥–∞–¥–∂–µ—Ç', '–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', '—Å–æ—Ü—Å–µ—Ç—å', 'instagram', 'facebook',
    'twitter', 'tiktok', '—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å', '–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Å–æ—Ñ—Ç', '–∞–ø–¥–µ–π—Ç', '–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ',
    '–Ω–æ—É—Ç–±—É–∫', '–∫–æ–º–ø—å—é—Ç–µ—Ä', '–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä', '–≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞', '–∏–≥—Ä–æ–≤–æ–π', '–¥–µ–≤–∞–π—Å',
    
    # –ò–≥—Ä—ã
    '–∏–≥—Ä–∞', '–≥–µ–π–º–µ—Ä', '–∏–≥—Ä–æ–≤–æ–π', 'playstation', 'xbox', 'nintendo', '–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç', '—Å—Ç—Ä–∏–º', '—Ç–≤–∏—á',
    'steam', '–∫–æ–Ω—Å–æ–ª—å', '–ø—Ä–∏—Å—Ç–∞–≤–∫–∞', '—Äpg', '—à—É—Ç–µ—Ä', '–∏–Ω–¥–∏-–∏–≥—Ä–∞', 'dlc', '–º–æ–¥',
    
    # –ï–¥–∞, –∫—É–ª–∏–Ω–∞—Ä–∏—è, –º–æ–¥–∞
    '—Ä–µ—Ü–µ–ø—Ç', '–∫—É–ª–∏–Ω–∞—Ä', '–µ–¥–∞', '–±—É—Ä–≥–µ—Ä', '–ø–∏—Ü—Ü–∞', '—Ä–µ—Å—Ç–æ—Ä–∞–Ω', '–∫–∞—Ñ–µ', '—à–µ—Ñ-–ø–æ–≤–∞—Ä', '–º–µ–Ω—é', '–±–ª—é–¥–æ',
    '–∫—É—Ö–Ω—è', '–ø—Ä–æ–¥—É–∫—Ç', '–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç', '–≥–æ—Ç–æ–≤–∫–∞', '–∫—É–ª–∏–Ω–∞—Ä–∏—è', '–¥–µ—Å–µ—Ä—Ç', '–≤—ã–ø–µ—á–∫–∞', '—Ç–æ—Ä—Ç', '–ø–∏—Ä–æ–≥',
    '–º–æ–¥–∞', '–¥–∏–∑–∞–π–Ω–µ—Ä', '–ø–æ–∫–∞–∑', '–∫–æ–ª–ª–µ–∫—Ü–∏—è', '–º–æ–¥–µ–ª—å', '–ø–æ–¥–∏—É–º', '–Ω–µ–¥–µ–ª—è –º–æ–¥—ã', '–±—Ä–µ–Ω–¥', '–æ–¥–µ–∂–¥–∞',
    '–Ω–∞—Ä—è–¥', '–∫–æ—Å—Ç—é–º', '–ø–ª–∞—Ç—å–µ', '–∞–∫—Å–µ—Å—Å—É–∞—Ä', '—é–≤–µ–ª–∏—Ä–Ω—ã–π', '—É–∫—Ä–∞—à–µ–Ω–∏–µ',
    
    # –ñ–∏–≤–æ—Ç–Ω—ã–µ –∏ –ø—Ä–∏—Ä–æ–¥–∞
    '–∫–æ—Ç–∏–∫', '–∫–æ—Ç', '–∫–æ—à–∫–∞', '—Å–æ–±–∞–∫–∞', '–ø–∏—Ç–æ–º–µ—Ü', '–∂–∏–≤–æ—Ç–Ω–æ–µ', '–∑–æ–æ–ø–∞—Ä–∫', '–ø–æ–≥–æ–¥–∞', '–≥–æ—Ä–æ—Å–∫–æ–ø',
    '–∞—Å—Ç—Ä–æ–ª–æ–≥', '–ø—Ä–∏—Ä–æ–¥–∞', '–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫', '–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫', '—Ñ–ª–æ—Ä–∞', '—Ñ–∞—É–Ω–∞',
    
    # –ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ (–Ω–µ–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ)
    '—Ç–µ–∞—Ç—Ä', '—Å–ø–µ–∫—Ç–∞–∫–ª—å', '–æ–ø–µ—Ä–∞', '–±–∞–ª–µ—Ç', '—Ö–æ—Ä', '–æ—Ä–∫–µ—Å—Ç—Ä', '–¥–∏—Ä–∏–∂–µ—Ä', '–≤—ã—Å—Ç–∞–≤–∫–∞', '–º—É–∑–µ–π',
    '–≥–∞–ª–µ—Ä–µ—è', '—Ö—É–¥–æ–∂–Ω–∏–∫', '—Å–∫—É–ª—å–ø—Ç–æ—Ä', '–∫–∞—Ä—Ç–∏–Ω–∞', '–∏—Å–∫—É—Å—Å—Ç–≤–æ', '–∞—Ä—Ç-',
    
    # –¢—É—Ä–∏–∑–º –∏ –æ—Ç–¥—ã—Ö
    '—Ç—É—Ä–∏–∑–º', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '–æ—Ç–¥—ã—Ö', '–∫—É—Ä–æ—Ä—Ç', '–æ—Ç–µ–ª—å', '–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞', '–∞–≤–∏–∞–±–∏–ª–µ—Ç', '—Ç—É—Ä', '–ø—É—Ç–µ–≤–∫–∞',
    '—ç–∫—Å–∫—É—Ä—Å–∏—è', '–¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–ø–ª—è–∂', '–º–æ—Ä–µ', '–≥–æ—Ä—ã', '–≥–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π',
    
    # –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ (–±—ã—Ç–æ–≤—ã–µ)
    '–∞–≤—Ç–æ–º–æ–±–∏–ª—å', '–º–∞—à–∏–Ω–∞', '–±–º–≤', '–º–µ—Ä—Å–µ–¥–µ—Å', '—Ç–æ–π–æ—Ç–∞', '—Ö—É–Ω–¥–∞–π', '–∫–∏–∞', '—Ñ–æ—Ä–¥', '—à–µ–≤—Ä–æ–ª–µ', '—Ç–µ—Å–ª–∞',
    '–¥–≤–∏–≥–∞—Ç–µ–ª—å', '—Ç—é–Ω–∏–Ω–≥', '–∞–≤—Ç–æ—Å–ø–æ—Ä—Ç', '—Ñ–æ—Ä–º—É–ª–∞-1', '–¥—Ä–∞–≥-—Ä–µ–π—Å–∏–Ω–≥',
    
    # –î–æ–º –∏ –±—ã—Ç
    '–¥–æ–º', '–∫–≤–∞—Ä—Ç–∏—Ä–∞', '—Ä–µ–º–æ–Ω—Ç', '–∏–Ω—Ç–µ—Ä—å–µ—Ä', '–¥–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞', '–º–µ–±–µ–ª—å', '—Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞', '—Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã',
    '—Å–∞–¥', '–æ–≥–æ—Ä–æ–¥', '—Ä–∞—Å—Ç–µ–Ω–∏–µ', '—Ü–≤–µ—Ç–æ–∫', '–¥–∞—á–∞', '–æ–≥–æ—Ä–æ–¥',
    
    # –ó–¥–æ—Ä–æ–≤—å–µ (–±—ã—Ç–æ–≤–æ–µ)
    '–¥–∏–µ—Ç–∞', '–ø–æ—Ö—É–¥–µ–Ω–∏–µ', '—Ñ–∏—Ç–Ω–µ—Å', '—Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª', '–π–æ–≥–∞', '–º–µ–¥–∏—Ç–∞—Ü–∏—è', '–≤–∏—Ç–∞–º–∏–Ω', '–±–∏–æ–¥–æ–±–∞–≤–∫–∞',
    '–±–∞–¥', '–∑–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ', '—Å—É–ø–µ—Ä—Ñ—É–¥',
    
    # –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    '—é–º–æ—Ä', '–∞–Ω–µ–∫–¥–æ—Ç', '–º–µ–º', '–ø—Ä–∏–∫–æ–ª', '—Ä–æ–∑—ã–≥—Ä—ã—à', '–ø—Ä–∞–Ω–∫', '—Å–æ–±—ã—Ç–∏–µ –¥–Ω—è', '—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–ø—É—Å–∫'
]

SUBSCRIBERS_FILE = 'subscribers.txt'

# –§–∏–ª—å—Ç—Ä —Å–ø–∞–º–∞
SPAM_PHRASES = [
    '–±–µ—Å–ø–ª–∞—Ç–Ω–æ', '–∫—É–ø–∏—Ç—å', '–ø—Ä–æ–¥–∞—Ç—å', '–∑–∞–∫–∞–∑–∞—Ç—å', '—Å–∫–∏–¥–∫–∞', '–∞–∫—Ü–∏—è', '—Ä–µ–∫–ª–∞–º–∞',
    '–∫–æ–º–º–µ—Ä—Ü–∏—è', '–æ–∑–æ–Ω', 'wildberries', '–Ω–∞–∫—Ä—É—Ç–∫–∞', '–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤', '–ª–∞–π–∫–æ–≤',
    '–¥–∏–ø–ª–æ–º', '–∫—É—Ä—Å–æ–≤–∞—è', '—É—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞', '—Ä–µ—Ü–∏–¥–∏–≤–∏—Å—Ç', '–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å',
    '–ø–ª–∞—Ç–∏–º –∑–∞ –≤–∞—à —ç–∫—Å–∫–ª—é–∑–∏–≤', '—Ç—Ä–∞–º–ø –≤–µ—Ä–Ω—É–ª—Å—è –≤ tiktok'
]

SPAM_URL_THRESHOLD = 3

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ===== –°–ò–°–¢–ï–ú–ê –ü–û–î–ü–ò–°–ß–ò–ö–û–í –° –í–ï–ß–ù–´–ú–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò =====
def load_subscribers():
    """–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (–≤–µ—á–Ω—ã–µ + –æ–±—ã—á–Ω—ã–µ)"""
    try:
        with open(SUBSCRIBERS_FILE, 'r', encoding='utf-8') as f:
            file_subs = [int(line.strip()) for line in f if line.strip().isdigit()]
    except FileNotFoundError:
        file_subs = []
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤–µ—á–Ω—ã—Ö –∏ –æ–±—ã—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏
    all_subs = list(set(PERMANENT_SUBSCRIBERS + file_subs))
    return all_subs

def save_subscribers(subscribers):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (–±–µ–∑ –≤–µ—á–Ω—ã—Ö)"""
    # –§–∏–ª—å—Ç—Ä—É–µ–º –≤–µ—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    regular_subs = [sub for sub in subscribers if sub not in PERMANENT_SUBSCRIBERS]
    
    try:
        with open(SUBSCRIBERS_FILE, 'w', encoding='utf-8') as f:
            for user_id in regular_subs:
                f.write(f"{user_id}\n")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {e}")

def add_subscriber(user_id):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞"""
    subscribers = load_subscribers()
    if user_id not in subscribers:
        subscribers.append(user_id)
        save_subscribers(subscribers)
        logger.info(f"‚úÖ –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫: {user_id}")
    return load_subscribers()

def remove_subscriber(user_id):
    """–£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ (–≤–µ—á–Ω—ã—Ö –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å)"""
    if user_id in PERMANENT_SUBSCRIBERS:
        logger.info(f"‚ö†Ô∏è –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –≤–µ—á–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞: {user_id}")
        return load_subscribers()
        
    subscribers = load_subscribers()
    if user_id in subscribers:
        subscribers.remove(user_id)
        save_subscribers(subscribers)
        logger.info(f"‚ùå –û—Ç–ø–∏—Å–∞–ª—Å—è: {user_id}")
    return load_subscribers()

# ===== –°–£–ü–ï–†-–§–ò–õ–¨–¢–† –î–õ–Ø –í–û–ô–ù–´ –ò –ü–û–õ–ò–¢–ò–ö–ò =====
def contains_war_keywords(text):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ç–µ–∫—Å—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤–æ–π–Ω—ã –∏ –ø–æ–ª–∏—Ç–∏–∫–∏"""
    if not text:
        return False
        
    text_lower = text.lower()
    
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ - –µ—Å–ª–∏ –µ—Å—Ç—å, —Å—Ä–∞–∑—É –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º
    for stop_word in STOP_WORDS:
        if stop_word in text_lower:
            logger.info(f"üö´ –û—Ç–±—Ä–æ—à–µ–Ω–æ –∏–∑-–∑–∞ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞: {stop_word}")
            return False
    
    # –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    for keyword in WAR_KEYWORDS:
        if keyword.lower() in text_lower:
            logger.info(f"‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É: {keyword}")
            return True
    
    return False

def is_spam_message(text):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–∞–º"""
    if not text:
        return True
        
    text_lower = text.lower()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∞–º-—Ñ—Ä–∞–∑
    for phrase in SPAM_PHRASES:
        if phrase in text_lower:
            return True
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Å—ã–ª–æ–∫
    urls = re.findall(r'http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+', text)
    if len(urls) > SPAM_URL_THRESHOLD:
        return True
    
    return False

# ===== –ë–ê–ó–ê –î–ê–ù–ù–´–• =====
def init_db():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    conn = sqlite3.connect('news.db', check_same_thread=False)
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS sent_posts (
            post_id TEXT PRIMARY KEY,
            channel TEXT,
            text TEXT,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    conn.commit()
    return conn

def is_post_sent(conn, post_id):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –ª–∏ –ø–æ—Å—Ç"""
    cursor = conn.cursor()
    cursor.execute("SELECT post_id FROM sent_posts WHERE post_id = ?", (post_id,))
    return cursor.fetchone() is not None

def mark_post_sent(conn, post_id, channel, text):
    """–ü–æ–º–µ—Ç–∏—Ç—å –ø–æ—Å—Ç –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π"""
    cursor = conn.cursor()
    cursor.execute(
        "INSERT OR IGNORE INTO sent_posts (post_id, channel, text) VALUES (?, ?, ?)",
        (post_id, channel, text[:500] if text else "")
    )
    conn.commit()

# ===== –ü–ê–†–°–ò–ù–ì RSS –° –°–£–ü–ï–†-–§–ò–õ–¨–¢–†–û–ú =====
async def parse_rss_feed(website_config):
    """–ü–∞—Ä—Å–∏–Ω–≥ RSS –ª–µ–Ω—Ç—ã —Å –∂–µ—Å—Ç–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π"""
    try:
        feed = feedparser.parse(website_config['url'])
        articles = []
        
        for entry in feed.entries[:15]:  # –ë–µ—Ä–µ–º 15 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç–∞—Ç–µ–π
            try:
                title = entry.title
                link = entry.link
                summary = entry.get('summary', '') or entry.get('description', '') or title
                
                # –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                full_text = f"{title} {summary}"
                
                # –ñ–ï–°–¢–ö–ê–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–Ø: —Ç–æ–ª—å–∫–æ –≤–æ–π–Ω–∞ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞
                if contains_war_keywords(full_text) and not is_spam_message(full_text):
                    articles.append({
                        'title': title,
                        'link': link,
                        'summary': summary,
                        'source': website_config['name'],
                        'text': full_text
                    })
                    
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ RSS: {e}")
                continue
                
        return articles
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ RSS {website_config['name']}: {e}")
        return []

async def check_all_feeds(conn, bot):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö RSS –ª–µ–Ω—Ç"""
    try:
        all_articles = []
        
        for website in WEBSITES:
            logger.info(f"üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º {website['name']}")
            
            articles = await parse_rss_feed(website)
            all_articles.extend(articles)
            logger.info(f"üìÑ –ù–∞–π–¥–µ–Ω–æ –í–û–ï–ù–ù–´–• —Å—Ç–∞—Ç–µ–π –Ω–∞ {website['name']}: {len(articles)}")
            
            await asyncio.sleep(1)
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç–µ–π
        sent_count = 0
        for article in all_articles:
            # –°–æ–∑–¥–∞–µ–º ID –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Å—ã–ª–∫–∏
            article_id = f"rss_{hash(article['link']) % 100000000}"
            
            if not is_post_sent(conn, article_id):
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
                subscribers = load_subscribers()
                message = format_website_message(article)
                
                success_count = 0
                for user_id in subscribers:
                    try:
                        await bot.send_message(
                            user_id, 
                            message, 
                            parse_mode='Markdown',
                            link_preview=True
                        )
                        success_count += 1
                        await asyncio.sleep(0.1)
                    except Exception as e:
                        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
                
                if success_count > 0:
                    mark_post_sent(conn, article_id, article['source'], article['title'])
                    sent_count += 1
                    logger.info(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –í–û–ï–ù–ù–ê–Ø –Ω–æ–≤–æ—Å—Ç—å {success_count} –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º —Å {article['source']}")
        
        if sent_count > 0:
            logger.info(f"üì® –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –í–û–ï–ù–ù–´–• —Å—Ç–∞—Ç–µ–π: {sent_count}")
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–µ–Ω—Ç: {e}")

def format_website_message(article):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏"""
    title = article['title']
    if len(title) > 200:
        title = title[:200] + "..."
    
    return (
        f"üéØ **–í–û–ï–ù–ù–ê–Ø –°–í–û–î–ö–ê**\n"
        f"üì∞ **{article['source']}**\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"**{title}**\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"üîó [–ß–∏—Ç–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ]({article['link']})"
    )

# ===== –û–ë–†–ê–ë–û–¢–ö–ê TELEGRAM –ö–ê–ù–ê–õ–û–í –° –°–£–ü–ï–†-–§–ò–õ–¨–¢–†–û–ú =====
async def handle_channel_message(event, conn, bot):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞ —Å –∂–µ—Å—Ç–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π"""
    try:
        message = event.message
        if not message.text:
            return
            
        text = message.text
        chat = await event.get_chat()
        channel_name = chat.username or chat.title or "Unknown"
        
        logger.info(f"üì® –°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ {channel_name}: {text[:100]}...")
        
        # –°–£–ü–ï–†-–§–ò–õ–¨–¢–†: —Å–Ω–∞—á–∞–ª–∞ —Å–ø–∞–º, –ø–æ—Ç–æ–º –≤–æ–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        if is_spam_message(text) or not contains_war_keywords(text):
            return
        
        # –°–æ–∑–¥–∞–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è
        message_id = f"tg_{channel_name}_{message.id}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ —É–∂–µ
        if is_post_sent(conn, message_id):
            return
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –í–°–ï–ú –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º (–≤–µ—á–Ω—ã–º –∏ –æ–±—ã—á–Ω—ã–º)
        subscribers = load_subscribers()
        message_text = format_telegram_message(text, channel_name, message.id)
        
        success_count = 0
        for user_id in subscribers:
            try:
                await bot.send_message(
                    user_id, 
                    message_text, 
                    parse_mode='Markdown',
                    link_preview=False
                )
                success_count += 1
                await asyncio.sleep(0.1)
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
        
        if success_count > 0:
            mark_post_sent(conn, message_id, channel_name, text)
            logger.info(f"‚úÖ –ü–µ—Ä–µ—Å–ª–∞–Ω–æ –í–û–ï–ù–ù–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ {channel_name} –¥–ª—è {success_count} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤")
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

def format_telegram_message(text, channel_name, message_id):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞"""
    # –û–±—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
    if len(text) > 3500:
        text = text[:3500] + "..."
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
    message_time = datetime.now().astimezone(pytz.timezone('Europe/Moscow')).strftime('%H:%M %d.%m.%Y')
    
    # –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
    message_url = f"https://t.me/{channel_name}/{message_id}" if not channel_name.startswith('@') else f"https://t.me/{channel_name[1:]}/{message_id}"
    
    return (
        f"üéØ **–í–û–ï–ù–ù–ê–Ø –°–í–û–î–ö–ê**\n"
        f"üì¢ **{channel_name}**\n"
        f"üïí {message_time}\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"{text}\n"
        f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
        f"üîó [–û—Ç–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ]({message_url})"
    )

# ===== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø =====
async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–æ—Ç–∞"""
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
    user_client = TelegramClient(StringSession(SESSION_STRING), API_ID, API_HASH)
    bot_client = TelegramClient('bot', API_ID, API_HASH)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
    db_conn = init_db()
    
    # –°–æ–∑–¥–∞–µ–º aiohttp —Å–µ—Å—Å–∏—é –¥–ª—è RSS
    aiohttp_session = aiohttp.ClientSession()
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    subscribers = load_subscribers()
    logger.info(f"üë• –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}")
    logger.info(f"üåü –í–µ—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(PERMANENT_SUBSCRIBERS)}")
    logger.info(f"üìù –û–±—ã—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers) - len(PERMANENT_SUBSCRIBERS)}")
    logger.info(f"üéØ –í–æ–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: {len(WAR_KEYWORDS)}")
    logger.info(f"üö´ –°—Ç–æ–ø-—Å–ª–æ–≤: {len(STOP_WORDS)}")
    
    # ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î –ë–û–¢–ê =====
    @bot_client.on(events.NewMessage(pattern='/start'))
    async def start_handler(event):
        user_id = event.sender_id
        subscribers = add_subscriber(user_id)
        await event.reply(
            "üéØ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫!**\n\n"
            "‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –í–û–ï–ù–ù–´–• –Ω–æ–≤–æ—Å—Ç–µ–π\n"
            "‚ö° –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ –≤–æ–µ–Ω–Ω—ã–µ –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–¥–∫–∏\n\n"
            "üéØ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** —Ç–æ–ª—å–∫–æ –≤–æ–π–Ω–∞, –ø–æ–ª–∏—Ç–∏–∫–∞, —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\n"
            "üö´ **–ò—Å–∫–ª—é—á–µ–Ω–æ:** —Å–ø–æ—Ä—Ç, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –Ω–∞—É–∫–∞, –±—ã—Ç–æ–≤—ã–µ —Ç–µ–º—ã\n\n"
            "‚ú® –ö–æ–º–∞–Ω–¥—ã:\n"
            "/stop - –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è\n"
            "/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
            "/id - —É–∑–Ω–∞—Ç—å —Å–≤–æ–π ID\n"
            "/filter - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö"
        )
        logger.info(f"üë§ –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫: {user_id}")
    
    @bot_client.on(events.NewMessage(pattern='/stop'))
    async def stop_handler(event):
        user_id = event.sender_id
        subscribers = remove_subscriber(user_id)
        await event.reply("‚ùå –í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç –≤–æ–µ–Ω–Ω—ã—Ö —Å–≤–æ–¥–æ–∫")
        logger.info(f"üë§ –û—Ç–ø–∏—Å–∞–ª—Å—è –æ—Ç –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫: {user_id}")
    
    @bot_client.on(events.NewMessage(pattern='/stats'))
    async def stats_handler(event):
        subscribers = load_subscribers()
        permanent_count = len([s for s in subscribers if s in PERMANENT_SUBSCRIBERS])
        regular_count = len(subscribers) - permanent_count
        
        await event.reply(
            f"üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í–û–ï–ù–ù–û–ô —Å–∏—Å—Ç–µ–º—ã:**\n\n"
            f"üë• –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}\n"
            f"üåü –í–µ—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {permanent_count}\n"
            f"üìù –û–±—ã—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {regular_count}\n"
            f"üì∞ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞–Ω–∞–ª–æ–≤: {len(CHANNELS)}\n"
            f"üåê –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —Å–∞–π—Ç–æ–≤: {len(WEBSITES)}\n"
            f"üéØ –í–æ–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: {len(WAR_KEYWORDS)}\n"
            f"üö´ –°—Ç–æ–ø-—Å–ª–æ–≤: {len(STOP_WORDS)}\n\n"
            f"‚ö° –†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ –í–û–ï–ù–ù–´–ï –∏ –ü–û–õ–ò–¢–ò–ß–ï–°–ö–ò–ï –Ω–æ–≤–æ—Å—Ç–∏"
        )
    
    @bot_client.on(events.NewMessage(pattern='/id'))
    async def id_handler(event):
        user_id = event.sender_id
        await event.reply(f"üÜî –í–∞—à ID: `{user_id}`")
    
    @bot_client.on(events.NewMessage(pattern='/filter'))
    async def filter_handler(event):
        await event.reply(
            "üéØ **–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –í–û–ï–ù–ù–´–• –Ω–æ–≤–æ—Å—Ç–µ–π:**\n\n"
            "‚úÖ **–ü–†–û–ü–£–°–ö–ê–ï–¢:**\n"
            "‚Ä¢ –í–æ–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—Ä—É–∂–∏–µ\n"
            "‚Ä¢ –ì–µ–æ–ø–æ–ª–∏—Ç–∏–∫–∞ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã\n"
            "‚Ä¢ –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∏ —Ñ—Ä–æ–Ω—Ç—ã\n"
            "‚Ä¢ –ü–æ–ª–∏—Ç–∏–∫–∞ –∏ –≤–ª–∞—Å—Ç—å\n"
            "‚Ä¢ –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\n\n"
            "üö´ **–ë–õ–û–ö–ò–†–£–ï–¢:**\n"
            "‚Ä¢ –°–ø–æ—Ä—Ç –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è\n"
            "‚Ä¢ –ù–∞—É–∫–∞ –∏ –∫–æ—Å–º–æ—Å\n"
            "‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–±—ã—Ç–æ–≤—ã–µ)\n"
            "‚Ä¢ –ò–≥—Ä—ã –∏ —Ö–æ–±–±–∏\n"
            "‚Ä¢ –ï–¥–∞, –º–æ–¥–∞, –∂–∏–≤–æ—Ç–Ω—ã–µ\n"
            "‚Ä¢ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ..."
        )
    
    @bot_client.on(events.NewMessage(pattern='/test'))
    async def test_handler(event):
        """–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã"""
        await event.reply("üéØ –°–∏—Å—Ç–µ–º–∞ –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç! –û–∂–∏–¥–∞–π—Ç–µ –≤–∞–∂–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏...")
    
    # ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–û–ë–©–ï–ù–ò–ô –ò–ó –ö–ê–ù–ê–õ–û–í =====
    @user_client.on(events.NewMessage(chats=CHANNELS))
    async def channel_message_handler(event):
        """–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –í–û–ï–ù–ù–´–• —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤"""
        await handle_channel_message(event, db_conn, bot_client)
    
    # ===== –§–û–ù–û–í–´–ï –ó–ê–î–ê–ß–ò =====
    async def rss_checker():
        """–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ RSS"""
        while True:
            try:
                logger.info("üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –í–û–ï–ù–ù–´–• RSS –ª–µ–Ω—Ç...")
                await check_all_feeds(db_conn, bot_client)
                logger.info("üí§ –°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç")
                await asyncio.sleep(600)  # 10 –º–∏–Ω—É—Ç
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ RSS —á–µ–∫–µ—Ä–µ: {e}")
                await asyncio.sleep(60)
    
    async def status_logger():
        """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞"""
        while True:
            try:
                subscribers = load_subscribers()
                logger.info(f"üìä –°—Ç–∞—Ç—É—Å –í–û–ï–ù–ù–û–ô —Å–∏—Å—Ç–µ–º—ã: {len(subscribers)} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤")
                await asyncio.sleep(3600)
            except Exception as e:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Å—Ç–∞—Ç—É—Å –ª–æ–≥–≥–µ—Ä–µ: {e}")
                await asyncio.sleep(300)
    
    # ===== –ó–ê–ü–£–°–ö –ë–û–¢–ê =====
    try:
        logger.info("üéØ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫...")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç—ã
        await bot_client.start(bot_token=BOT_TOKEN)
        await user_client.start()
        
        # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
        subscribers = load_subscribers()
        logger.info("‚úÖ –°–∏—Å—Ç–µ–º–∞ –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!")
        logger.info(f"üìä –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:")
        logger.info(f"   üë• –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(subscribers)}")
        logger.info(f"   üåü –í–µ—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {len(PERMANENT_SUBSCRIBERS)}")
        logger.info(f"   üéØ –í–æ–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: {len(WAR_KEYWORDS)}")
        logger.info(f"   üö´ –°—Ç–æ–ø-—Å–ª–æ–≤: {len(STOP_WORDS)}")
        logger.info("‚ö° –†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ –í–û–ï–ù–ù–´–ï –∏ –ü–û–õ–ò–¢–ò–ß–ï–°–ö–ò–ï –Ω–æ–≤–æ—Å—Ç–∏")
        
        if len(subscribers) == 0:
            logger.warning("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É /start")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
        asyncio.create_task(rss_checker())
        asyncio.create_task(status_logger())
        
        # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
        await asyncio.Future()
        
    except Exception as e:
        logger.error(f"üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ: {e}")
    finally:
        # –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        await user_client.disconnect()
        await bot_client.disconnect()
        await aiohttp_session.close()
        db_conn.close()
        logger.info("üõë –°–∏—Å—Ç–µ–º–∞ –í–û–ï–ù–ù–´–• —Å–≤–æ–¥–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")

if __name__ == '__main__':
    # –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if not os.path.exists(SUBSCRIBERS_FILE):
        with open(SUBSCRIBERS_FILE, 'w', encoding='utf-8') as f:
            pass
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    asyncio.run(main())
